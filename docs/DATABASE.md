## Database

### Engine & Versions
- PostgreSQL 16+
- Npgsql provider 9.x for EF Core

### Connection
- Config key: `ConnectionStrings:Default`
- Local dev (User Secrets recommended):
  - `Host=localhost;Port=5432;Database=OECore;Username=postgres;Password=postgres`

### Conventions
- Naming: snake_case for tables and columns
- Table names: singular (e.g., `user`, `order_item`)
- Primary key: `id` bigint generated by identity (default). Optional: UUID if needed
- Timestamps: `created_at` (utc), `updated_at` (utc)
- Soft delete (optional): `deleted_at` nullable timestamp
- Foreign keys: `<entity>_id`

### EF Core Configuration
- Provider: `UseNpgsql(connectionString)`
- Add naming conventions (recommended): `EFCore.NamingConventions`
  - `options.UseNpgsql(conn).UseSnakeCaseNamingConvention()`
- Place all entity configurations via Fluent API in `OECore.Infrastructure`
- Keep `DbSet<TEntity>` properties in `AppDbContext`

### Migrations
- Location: `src/OECore.Infrastructure/Migrations`
- Create: `dotnet ef migrations add <Name> -s src/OECore.Api/OECore.Api.csproj -p src/OECore.Infrastructure/OECore.Infrastructure.csproj -o src/OECore.Infrastructure/Migrations`
- Apply: `dotnet ef database update -s src/OECore.Api/OECore.Api.csproj -p src/OECore.Infrastructure/OECore.Infrastructure.csproj`

### Schema Requirements (to be refined)
- Enumerate entities and relationships here
- Define indexes: unique, composite, and FK indexes
- Define constraints: not null, length, check constraints when applicable
- Consider JSONB columns for flexible data where appropriate

### Data Types Guidance
- Identifiers: bigint (default) or uuid
- Monetary: `numeric(18,2)` or `money` (prefer `numeric`)
- Text: `text` or `varchar(n)` as needed
- Dates: `timestamp with time zone` (store UTC)
- Boolean: `boolean`

### Performance & Ops
- Index strategy: add indexes for FK columns and frequent filters/sorts
- Pagination: use keyset or offset/limit per use case
- Health check: add Npgsql health check in API (future)
- Backups: define schedule (pg_dump), retention policy (future)

### Environments
- Dev: local PostgreSQL or Docker
- Test: isolated DB per run or schema with cleanup
- Prod: managed PostgreSQL (SSL required), secrets via environment

### Open Questions / TODO
- Entity list and ERD diagram
- Audit strategy (created_by/updated_by)
- Soft-delete policy and global filters
- Partitioning needs (if any large tables)


